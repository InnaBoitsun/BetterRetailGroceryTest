@inherits Composer.Razor.ComposerRazorFunction

@functions {
    public override string FunctionDescription
    {
        get { return "Shipping"; }
    }
}

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://www.composite.net/ns/function/1.0" xmlns:v-bind="v-bind" xmlns:v-on="v-on" xmlns:v-slot="v-slot">
<head>
</head>
<body>
    <div data-oc-controller="SingleCheckout.Shipping">
        <div class="card  mt-4">
            <div class="card-header">
                <h4 class="float-left">
                    @Html.Localize("CheckoutProcess", "F_ShippingStepTitle")
                </h4>
                <button v-show="step.displayContinueButton"
                        v-bind:disabled="!FulfilledCustomer"
                        v-on:click="step.navigateToStep(step.index)"
                        class="btn btn-primary float-right"
                        v-cloak="true"
                        data-qa="continue-to-shipping-btn">
                    @Html.Localize("CheckoutProcess", "F_Continue")
                </button>

                <button v-show="step.preview" class="btn btn-outline-secondary float-right" data-qa="edit-shipping-btn"
                        v-on:click="step.navigateToStep(step.index)"
                        v-cloak="true">
                    @Html.Localize("CheckoutProcess", "F_Edit")
                </button>
            </div>

            <div class="card-body  bg-light" v-show="step.active" v-cloak="true" data-qa="shipping-active-state">
                <p>@Html.Localize("CheckoutProcess", "F_ShippingStepDescription")</p>

                <div class="form-row" novalidate="novalidate" id="AccordionShippingMethodType">
                    <div class="col-md-6 pb-3" v-for="shippingMethodType in ShippingMethodTypes">
                        <div class="border  rounded bg-white  p-3">
                            <div class="form-check">

                                <input data-parsley-class-handler-selector=".card-body"
                                       data-parsley-errors-container="#method-errors"
                                       class="form-check-input" type="radio"
                                       v-bind:checked="shippingMethodType.FulfillmentMethodTypeString === SelectedMethodTypeString"
                                       v-bind:disabled="IsLoading"
                                       required="required"
                                       name="SelectedShippingMethodType"
                                       xmlns:v-bind="v-bind"
                                       v-bind:value="shippingMethodType.FulfillmentMethodTypeString"
                                       v-bind:id="shippingMethodType.FulfillmentMethodTypeString + '-radio'"
                                       v-on:change="changeShippingMethodType"
                                       xmlns:v-on="v-on" />

                                <label class="form-check-label d-block" v-bind:for="shippingMethodType.FulfillmentMethodTypeString + '-radio'">
                                    <div class="d-flex justify-content-between">
                                        <p class="h4 ">{{shippingMethodType.DisplayName}}</p>

                                        <div class="text-right" v-if="shippingMethodType.SelectedMethod">
                                            <p class="h4">{{shippingMethodType.SelectedMethod.Cost || @Html.Localize("ShoppingCart", "L_Free")}}</p>
                                        </div>
                                    </div>
                                    <div v-if="shippingMethodType.SelectedMethod">
                                        <p class="mb-0" v-if="shippingMethodType.IsModified">
                                            <strong v-if="shippingMethodType.SelectedMethod">
                                                {{shippingMethodType.SelectedMethod.DisplayName}}
                                            </strong> |
                                            <a v-bind:href="'#ShippingMethod' + shippingMethodType.FulfillmentMethodTypeString"
                                               data-toggle="collapse"
                                               role="button"
                                               aria-expanded="true"
                                               v-bind:aria-controls="'ShippingMethod' + shippingMethodType.FulfillmentMethodTypeString"
                                               class="cta">
                                                @Html.Localize("CheckoutProcess", "F_ChangeShippingMethod")
                                            </a>
                                        </p>
                                        <span v-if="shippingMethodType.SelectedMethod.ExpectedDaysBeforeDelivery" class="clearfix">
                                            <strong>@Html.Localize("CheckoutProcess", "F_ShipTimeTitle")</strong>
                                            {{shippingMethodType.SelectedMethod.ExpectedDaysBeforeDelivery}}
                                            @Html.Localize("CheckoutProcess", "L_DeliveryDaysNumber")
                                        </span>
                                    </div>
                                </label>
                            </div>
                            <div class="collapse  mt-4  border-top"
                                 v-if="shippingMethodType.IsModified"
                                 v-bind:Id="'ShippingMethod' + shippingMethodType.FulfillmentMethodTypeString"
                                 data-parent="#AccordionShippingMethodType">
                                <ul class="list-group list-group-flush">
                                    <li v-for="shippingMethod in shippingMethodType.ShippingMethods" class="list-group-item">
                                        <div class="row">
                                            <div class="col-8">
                                                <p class="mb-0 font-weight-bolder">{{shippingMethod.DisplayName}}</p>
                                                <p v-if="shippingMethod.ExpectedDaysBeforeDelivery" class="mb-0">
                                                    @Html.Localize("CheckoutProcess", "F_ShipTimeTitle") {{shippingMethod.ExpectedDaysBeforeDelivery}} @Html.Localize("CheckoutProcess", "L_DeliveryDaysNumber")
                                                </p>
                                                <p class="mb-0 font-weight-bolder">{{shippingMethod.Cost}}</p>
                                            </div>
                                            <div class="col-4">
                                                <button class="btn btn-outline-secondary float-right" v-on:click='selectShippingMethod(shippingMethod)' v-bind:disabled="IsLoading">
                                                    @Html.Localize("CheckoutProcess", "F_SelectShippingMethod")
                                                </button>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <transition name="fade">
                    <div v-if="IsShippingMethodType" class="mt-2  pt-2  border-top">
                        <div v-if="IsAuthenticated">
                            <div v-for="address in RegisteredAddresses"
								 v-bind:key="address.Id"
								 class="border  rounded p-3  mb-2"
								 v-bind:class="{ 'bg-light border-primary': address.Id == SelectedShippingAddressId, 'bg-white': address.Id != SelectedShippingAddressId}">

							     @CustomerShippingAddressRadio()
								
                            </div>
							<div v-if="AddingNewAddressMode">
								  @Forms.ShippingAddress.Form("AddNewAddress", "addNewAddressForm")
							</div>
							<div>
								<button class="btn btn-link" v-on:click="AddingNewAddressMode=true">Add New Address</button>
							</div>
                        </div>
                        <div v-else="v-else">
                            <div data-oc-controller="SingleCheckout.ShippingAddress">
                                @Forms.ShippingAddress.Form("Cart.ShippingAddress", "addressForm")
                            </div>
                        </div>
                    </div>
                </transition>
            </div>
            <div class="card-body" v-show="step.preview" v-cloak="true" data-qa="shipping-preview-state">
                <div v-if="Cart.ShippingMethod">
                    <div class="row">
                        <div class="col-12 col-sm-10">
                            <p class="h4">{{Cart.ShippingMethod.DisplayName}}</p>
                            @CheckoutHelpers.ShippingAddressPreview("ShippingAddress")
                            <span v-if="Cart.ShippingMethod.ExpectedDaysBeforeDelivery" data-qa="shippingmethod-expecteddays-info" class="clearfix">
                                <strong>@Html.Localize("CheckoutProcess", "F_ShipTimeTitle")</strong> {{Cart.ShippingMethod.ExpectedDaysBeforeDelivery}} @Html.Localize("CheckoutProcess", "L_DeliveryDaysNumber")
                            </span>
                        </div>
                        <div class="col-12 col-sm-2">
                            @Html.Localize("MyAccount", "L_Total"): <span>{{Cart.ShippingMethod.Cost}}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

@helper CustomerShippingAddressRadio()
{
    <div class="form-check">
        <input data-parsley-errors-container="#adresses-errors"
               class="form-check-input" type="radio"
               v-bind:checked="address.Id === SelectedShippingAddressId"
               v-bind:disabled="IsLoading"
               required="required"
               name="ShippingAddressId"
               v-bind:value="address.ShippingAddressId"
               v-bind:id="address.Id + '-radio'"
               v-on:change=""
               xmlns:v-on="v-on"
               xmlns:v-bind="v-bind" />
        <label class="form-check-label d-block" v-bind:for="address.Id + '-radio'">
            <div class="row">
                <div class="col-12 col-sm-9 order-2  order-sm-1">@CheckoutHelpers.ShippingAddressPreview("address")</div>
                <div class="col-12 col-sm-3  order-1  order-sm-2 font-weight-bolder"><p class="text-left text-sm-right"> {{address.AddressName}}</p></div>
            </div>
        </label>
    </div>
}
